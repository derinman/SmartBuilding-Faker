<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="X-UA-Compatible" content="ie=edge">
  <title>發送消息至firebase</title>
</head>

<body>
  <!-- firebase 本身 ref 的設定 -->
  <script src="https://www.gstatic.com/firebasejs/5.10.0/firebase.js"></script>
  <script>
    // Initialize Firebase
    var config = {
      // apiKey: "AIzaSyDXcHE4Tmy8sStP4T1Nsnr25_G7iLjt7HI",
      // authDomain: "water-c1ecf.firebaseapp.com",
      databaseURL: "https://water-c1ecf.firebaseio.com",
      // projectId: "water-c1ecf",
      // storageBucket: "water-c1ecf.appspot.com",
      // messagingSenderId: "185826267369"
    };
    firebase.initializeApp(config);
  </script>

  <div class="info">
    <div class="info--title">工安監控 測資輸入(一般)</div>
    <form onsubmit="return addtestDataItem(this)">
      <label for="id">id</label>
      <input name="id" value="伊閩"><br>
      <label for="idDevice">idDevice</label>
      <input name="idDevice" value="test-mobile"><br>
      <label for="date">date</label>
      <input name="date" value="" type="date" class="date"><br>
      <label for="time">time</label>
      <input name="time" value="00:00:00:000" class="time"><br>
      <label for="accident">accident</label>
      <input name="accident" value="0" ><br>
      
      <label for="latitude">latitude</label>
      <input name="latitude" min="25.049914" max="25.050234" step="0.000001" type="range" class="latitude"><br>
      <label for="longitude">longitude</label>
      <input name="longitude" min="121.568852" max="121.569117" step="0.000001" type="range" class="longitude"><br>
      
      <label for="accX">accX</label>
      <input name="accX" value="0"><br>
      <label for="accY">accY</label>
      <input name="accY" value="0"><br>
      <label for="accZ">accZ</label>
      <input name="accZ" value="0"><br>
      <label for="portent">portent</label>
      <input name="portent" value="1"><br>
      <label for="site">site</label>
      <input name="site" value="CTC"><br>
      <label for="altitude">altitude</label>
      <input name="altitude" value="37"><br>
      <label for="heartRate">heartRate</label>
      <input name="heartRate" value="60"><br>
      <input type="submit" value="Add item" >
      <input type="button" value="Show list" onclick="console.log(testData)">
    </form>
    <button onclick="writeData()">發送測試資料</button>
  </div>
  
  <br>
  
  <div class="info">
    <div class="info--title">工安監控 測資輸入(機具)</div>
    <form onsubmit="return addtestDataMachineItem(this)">
      <label for="id">id</label>
      <input name="id" value="伊閩"><br>
      <label for="idDevice">idDevice</label>
      <input name="idDevice" value="test-mobile"><br>
      <label for="date">date</label>
      <input name="date" value="" type="date" class="date"><br>
      <label for="time">time</label>
      <input name="time" value="00:00:00:000" class="time"><br>
      <label for="accident">accident</label>
      <input name="accident" value="0" ><br>
      
      <label for="latitude">latitude</label>
      <input name="latitude" min="25.049914" max="25.050234" step="0.000001" type="range" class="latitude"><br>
      <label for="longitude">longitude</label>
      <input name="longitude" min="121.568852" max="121.569117" step="0.000001" type="range" class="longitude"><br>
      
      <label for="accX">accX</label>
      <input name="accX" value="0"><br>
      <label for="accY">accY</label>
      <input name="accY" value="0"><br>
      <label for="accZ">accZ</label>
      <input name="accZ" value="0"><br>
      <label for="portent">portent</label>
      <input name="portent" value="1"><br>
      <label for="site">site</label>
      <input name="site" value="CTC"><br>
      <label for="altitude">altitude</label>
      <input name="altitude" value="37"><br>
      <label for="heartRate">heartRate</label>
      <input name="heartRate" value="60"><br>
      <label for="machine">machine</label>
      <input name="machine" value="true"><br>
      <label for="machineName">machineName</label>
      <input name="machineName" value="挖土機XX號"><br>

      <input type="submit" value="Add item">
      <input type="button" value="Show list" onclick="console.log(testDataMachine)">
    </form>
    <button onclick="writeDataMachine()">發送測試資料</button>
  </div>
  <br>
  <button onclick="delateAllData()">!!  清空firebase資料</button>

  <script>
    var testData= {}
    function addtestDataItem(form) {
      testData= {             
                  id:form.id.value,
                  idDevice:form.idDevice.value,
                  date:form.date.value,
                  time:form.time.value,
                  accident:parseInt(form.accident.value),
                  latitude:parseFloat(form.latitude.value),
                  accX:parseInt(form.accX.value),
                  accY:parseInt(form.accY.value),
                  accZ:parseInt(form.accZ.value),
                  portent:parseInt(form.portent.value),
                  site:form.site.value,
                  altitude:parseFloat(form.altitude.value),
                  longitude:parseFloat(form.longitude.value),
                  heartRate:parseFloat(form.heartRate.value),
                  };
    return false;
    }

    var testDataMachine= {}
    function addtestDataMachineItem(form) {
      testDataMachine = {             
                  id:form.id.value,
                  idDevice:form.idDevice.value,
                  date:form.date.value,
                  time:form.time.value,
                  accident:parseInt(form.accident.value),
                  latitude:parseFloat(form.latitude.value),
                  accX:parseInt(form.accX.value),
                  accY:parseInt(form.accY.value),
                  accZ:parseInt(form.accZ.value),
                  portent:parseInt(form.portent.value),
                  site:form.site.value,
                  altitude:parseFloat(form.altitude.value),
                  longitude:parseFloat(form.longitude.value),
                  heartRate:parseFloat(form.heartRate.value),
                  machine:JSON.parse(form.machine.value),
                  machineName:form.machineName.value,
                  };
    return false;
    }

    // 設定今日現在時間為預設
    function checkTime(i) {
        return (i < 10) ? "0" + i : i;
    }
    function updateTime(){
    let d = new Date();
    const dateFormat = (dateObj) => dateObj.split(' ')[0].split('/').map(n => n.length === 1 ? '0' + n : n).join('-')
    let todayDate = dateFormat(d.toLocaleString('zn-TW'))
    let todaytime = checkTime(d.getHours())+":"+checkTime(d.getMinutes())+":"+checkTime(d.getSeconds())+":"+"0000";
    
    document.getElementsByClassName("date")[0].value = todayDate;
    document.getElementsByClassName("time")[0].value = todaytime;
    document.getElementsByClassName("date")[1].value = todayDate;
    document.getElementsByClassName("time")[1].value = todaytime;
    }
    setInterval(updateTime, 1000);
    
    //隨機跳動經緯度
    function updateLatLon(){
    let latitudeMin = 25.049914;
    let latitudeMax = 25.050234;
    let longitudeMin = 121.568852;
    let longitudeMax = 121.569117;
    randLatitude = (latitudeMax-latitudeMin)*Math.random()+latitudeMin
    randLongitude = (longitudeMax-longitudeMin)*Math.random()+longitudeMin
    
    document.getElementsByClassName("latitude")[0].value = randLatitude;
    document.getElementsByClassName("longitude")[0].value = randLongitude;
    document.getElementsByClassName("latitude")[1].value = randLatitude;
    document.getElementsByClassName("longitude")[1].value = randLongitude;
    }
    setInterval(updateLatLon, 1000);
    
    

    //firebase
    const db = firebase.database()
    let childKeyList = []
    // 寫入資料(一般)
    function writeData(){db.ref(`/CTC/${testData.date}_${testData.time}_${testData.id}`).set(testData)};
    // 寫入資料(機具)
    function writeDataMachine(){db.ref(`/CTC/${testDataMachine.date}_${testDataMachine.time}_${testDataMachine.id}`).set(testDataMachine)};
    
    function delateAllData (){db.ref(`/CTC/`).set('')};

    // 刪除單一資料
    // db.ref(`/CTC/${testData.date}_${testData.time}_${testData.id}`).remove();
    //db.ref(`/CTC/`).remove()
    // 刪除 搜尋資料 by value後 remove
    // db.ref(`/${testData.site}`).orderByChild('id').equalTo('測試').once('child_added', function (snapshot) {
      // console.log(snapshot.toJSON())
      // snapshot.ref.remove();
    // });

  </script>

</body onload="startTime()">

</html>