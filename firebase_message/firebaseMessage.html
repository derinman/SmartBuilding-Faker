<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="X-UA-Compatible" content="ie=edge">
  <title>發送消息至firebase</title>
</head>

<body>
  <!-- firebase 本身 ref 的設定 -->
  <script src="https://www.gstatic.com/firebasejs/5.10.0/firebase.js"></script>
  <script>
    // Initialize Firebase
    var config = {
      // apiKey: "AIzaSyDXcHE4Tmy8sStP4T1Nsnr25_G7iLjt7HI",
      // authDomain: "water-c1ecf.firebaseapp.com",
      databaseURL: "https://water-c1ecf.firebaseio.com",
      // projectId: "water-c1ecf",
      // storageBucket: "water-c1ecf.appspot.com",
      // messagingSenderId: "185826267369"
    };
    firebase.initializeApp(config);
  </script>
  <!-- 結束 -->

  <script>
    /*
    let testData = {
      id: 'inman2',
      idDevice: 'test-mobile',
      date: '2020-06-05',
      time: '11:42:00:000',
      accident: 0,
      latitude: 25.050062, 
      longitude: 121.568989,
      portent: 1,
      site: 'CTC',
      altitude: 37,
      heartRate: 60,
      accX: 0,
      accY: 0,
      accZ: 0,
    }
    console.log(testData);
    */
  var testData2 = {}
  function addtestData2Item(form) {
    testData2 = {             
                  id:form.id.value,
                  idDevice:form.idDevice.value,
                  date:form.date.value,
                  time:form.time.value,
                  accident:parseInt(form.time.value),
                  latitude:parseFloat(form.latitude.value),
                  accX:parseInt(form.accX.value),
                  accY:parseInt(form.accY.value),
                  accZ:parseInt(form.accZ.value),
                  portent:parseInt(form.portent.value),
                  site:form.site.value,
                  altitude:parseFloat(form.altitude.value),
                  longitude:parseFloat(form.longitude.value),
                  heartRate:parseFloat(form.heartRate.value),
                  };
    return false;
  }
  </script>



  <div class="info">
    <div class="info--title">工安監控 測資輸入</div>
    <form onsubmit="return addtestData2Item(this)">
      <label for="id">id</label>
      <input name="id" value="inman2"><br>
      <label for="idDevice">idDevice</label>
      <input name="idDevice" value="test-mobile"><br>
      <label for="date">date</label>
      <input name="date" value="" type="date"><br>
      <label for="time">time</label>
      <input name="time" value="00:00:00:000"><br>
      <label for="accident">accident</label>
      <input name="accident" value="0" ><br>
      <label for="latitude">latitude</label>
      <input name="latitude" value="25.050062"><br>
      <label for="accX">accX</label>
      <input name="accX" value="0"><br>
      <label for="accY">accY</label>
      <input name="accY" value="0"><br>
      <label for="accZ">accZ</label>
      <input name="accZ" value="0"><br>
      <label for="portent">portent</label>
      <input name="portent" value="1"><br>
      <label for="site">site</label>
      <input name="site" value="CTC"><br>
      <label for="altitude">altitude</label>
      <input name="altitude" value="37"><br>
      <label for="longitude">longitude</label>
      <input name="longitude" value="121.568989"><br>
      <label for="heartRate">heartRate</label>
      <input name="heartRate" value="60"><br>
      <input type="submit" value="Add item">
      <input type="button" value="Show list" onclick="console.log(testData2)">
    </form>

    <button onclick="writeData()">發送測試資料</button>
  </div>

  <script>
    // 設定今日為預設
    const dateFormat = (dateObj) => dateObj.split(' ')[0].split('/').map(n => n.length === 1 ? '0' + n : n).join('-')
    let todayDate = dateFormat(new Date().toLocaleString('zn-TW'))
    // (new Date().toLocaleString('zn-TW',))
    //document.querySelector('#date').value = todayDate;
    console.log(todayDate)

    const db = firebase.database()
    let childKeyList = []

    // 寫入資料
    function writeData(){db.ref(`/CTC/${testData2.date}_${testData2.time}_${testData2.id}`).set(testData2)};

    // 刪除單一資料
    // db.ref(`/CTC/${testData.date}_${testData.time}_${testData.id}`).remove();

    // 刪除 搜尋資料 by value後 remove
    // db.ref(`/${testData.site}`).orderByChild('id').equalTo('測試').once('child_added', function (snapshot) {
      // console.log(snapshot.toJSON())
      // snapshot.ref.remove();
    // });

  </script>

</body>

</html>