<!DOCTYPE html>
<html>
<head>

</head>

<body>

<p>firebaseMessageSender</p>
<form onsubmit="return addMessage(this)">
    <label for="id">id</label><br>
    <input name="id" value="伊閩"><br>
    <label for="status">status</label><br>
    <input type="radio" id="status" name="status" value="僅為誤報，人員安全" checked>
    <label for="status">僅為誤報</label>
    <input type="radio" id="status" name="status" value="立即通知救護人員!!" >
    <label for="status">確認危險</label><br>
    <br>
    <input type="submit" value="Add item">
    <input type="button" value="Show list" onclick="console.log(message)">
</form>

<button onclick="sendToAllClient(tokens)">發送意外人員回報</button>

<script>

    //抓取web端form輸入的資料
    let message= {}
    function addMessage(form) {
        message = {             
            id:form.id.value,
            status:form.status.value,
        };
    return false;
    }

    //客戶端的tokens
    let tokens = ["dgd5QBGk5AYMpe-qTUuGQ8:APA91bEliFJCDcxozl_O7PsVywLG8LFR5-Y7_FhJxiP7OkISHvIc5ac9olq2KdcfYamnPCa2-OZynlT8NkNT0j08Gob1E95lksmF2vXRJ8ahzTl46cER7v2kqUBiQf2RMlJfo7seGaZV",
                "dOBfifKBXIRHwgkus1hM_V:APA91bFBMEg6qAitKPLBdc6vGoEC0lMWJI1DNcHJzIcfQoyBpYbFbyfCgSl3ngwX31oklv4YusLq03GlC3PRvntTczcarL0Pm-2aBHaHEFzN4PEDWkHvs_AgZec35ZaDPdG0bmdnxR85",
                "d3kaR7p9qkiNUBRET0ExaX:APA91bFhsUNe78CMu-30fchg3bgX4g96cibLLeyBpJ0ID6tefrAeJ0bdJf1_fFbM-N8m-txWMK8bgDACEJ7de4NnM6u-zzbbYLKTZ8wpqK6CiSRtGOG9LmYe0JGfHXHV_A5oNIINNg8x"]

    //傳送給單一client
    const sendToClient = (token) => {fetch('https://fcm.googleapis.com/fcm/send', {
            'method': 'POST',
            'headers': {
                    'Authorization': 'key=AAAAK0Qb0Ok:APA91bEn4pe-h4XKOo3pMP3ll9E4MBSDX9DSGTVIwMRrII8cOKZlXZ3M7OD-rpi7cwvif4eUbZWoFSW2NOpnulPYG2IfuUsoVspMO-lBYI9drQ3fd4CstpC03N16JWLCEYDOW7SqgBkq',
                    'Content-Type': 'application/json'
                },
            'body': JSON.stringify({
                    "data":{
                        "message": message,
                    },
                    "to": token,
            })
            }).then(function(response) {
                console.log(response);
            }).catch(function(error) {
                alert(error)});}

    //傳送給所有client
    const sendToAllClient=(tokens)=>{
        tokens.forEach((data)=>
            sendToClient(data)
        )
    }

</script>

</body>
</html>